/*! qajax 1.0.2 - Simple Promise ajax library based on Q */
!function(a,b){"object"==typeof exports?module.exports=b:"function"==typeof define&&define.amd?define(["q"],function(c){return b(c,a.XMLHttpRequest)}):a.Qajax=b(a.Q,a.XMLHttpRequest)}(this,function(a,b){"use strict";function c(){}function d(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&void 0!==a[b]&&c.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]));return c.join("&")}function e(a){return-1===a.indexOf("?")}function f(b,c){if(0===arguments.length)throw new Error("Qajax: settings are required");var f;if("string"==typeof b)f="object"==typeof c&&c||{},f.url=b;else{if("object"!=typeof b)throw new Error("Qajax: settings must be an object");f=b}if(!f.url)throw new Error("Qajax: settings.url is required");if("cancellation"in f&&!a.isPromiseAlike(f.cancellation))throw new Error("cancellation must be a Promise.");this.headers={},this.params={};for(var g in f)this[g]=f[g];var i=this.params,j=this.cache;j&&(i[j===!0?"_":j]=(new Date).getTime());var k=this.base+this.url,l=d(i);l&&(k=k+(e(k)?"?":"&")+l),this.url=k;var m=this.data,n=this.headers;null!==m&&"object"==typeof m&&(h in n||(n[h]="application/json"),this.data=JSON.stringify(m));var o=this._send,p=this;this.send=function(){return a.fcall(function(){return o.call(p)})}}function g(a,b){return new f(a,b).send()}var h="Content-Type",i=a.defer().promise;return f.prototype={log:c,timeout:6e4,cache:"undefined"==typeof window?!1:!!(window.ActiveXObject||"ActiveXObject"in window),method:"GET",base:"",withCredentials:!1,cancellation:i,_send:function(){var c=new b,d=a.defer(),e=this.log,f=this.method,g=this.url;c.onreadystatechange=function(){if(4===c.readyState)try{e(f+" "+g+" => "+c.status),c.status?d.resolve(c):d.reject(c)}catch(a){d.reject(c)}},c.onprogress=function(a){d.notify(a)},c.open(f,g,!0),this.responseType&&(c.responseType=this.responseType);var h=this.headers;for(var i in h)h.hasOwnProperty(i)&&c.setRequestHeader(i,h[i]);this.withCredentials&&(c.withCredentials=!0);var j=this.data;return void 0!==j&&null!==j?c.send(j):c.send(),this.cancellation.fin(function(){d.promise.isFulfilled()||(e("Qajax cancellation reached."),c.abort())}),this.timeout?d.promise.timeout(this.timeout).fail(function(a){throw a instanceof Error&&(e("Qajax request delay reach in "+f+" "+g),c.abort()),c}):d.promise}},g.defaults=f.prototype,g.Builder=f,g.filterStatus=function(b){var c,d,e=this.log;if(d=typeof b,"function"===d)c=b;else{if("number"!==d)throw"validStatus type "+d+" unsupported";c=function(a){return a===b}}return function(b){var d=0;try{d=b.status}catch(f){e("Qajax: failed to read xhr.status")}return 1223===d&&(d=204),c(d)?a.resolve(b):a.reject(b)}},g.filterSuccess=g.filterStatus(function(a){return a>=200&&300>a||304===a}),g.toJSON=function(b){return a.fcall(function(){return JSON.parse(b.responseText)})},g.getJSON=function(a){return g({url:a,method:"GET"}).then(g.filterSuccess).then(g.toJSON)},g.serialize=d,g});